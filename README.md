# Agreement System

Lightweight convergence layer between product (BMAD), implementation (Spec Kit), and code.

> One feature = one Agreement = one explicit promise.

## The problem

When BMAD produces product artifacts and Spec Kit produces implementation artifacts,
nothing guarantees they stay aligned with the shipped code. The PRD says one thing,
the API contract says another, the code does a third. Drift is invisible until
something breaks.

## The solution

An **Agreement** is a lightweight YAML artifact that captures the shared promise
between product intent, implementation decisions, and actual code. It doesn't replace
any existing tool — it's the convergence point they all reference.

## Install

```bash
npx agreement-system init
```

The installer detects your environment and adapts:

| Detected | What happens |
|----------|-------------|
| BMAD (`_bmad/`) | Adds Agreement menu items to BMAD agents via `customize.yaml` |
| Spec Kit (`.specify/`) | Confirms `/agreement.doctor` compatibility with `/speckit.implement` |
| Neither | Installs standalone (commands + templates only) |

## Update

```bash
npx agreement-system update
```

Updates commands and templates without touching your existing agreements or config.

## Commands

| Command | Role |
|---------|------|
| `/agreement.create` | Create an Agreement for a feature |
| `/agreement.sync` | Sync Agreement with BMAD/Spec Kit artifacts |
| `/agreement.check` | Detect code drift against the Agreement |
| `/agreement.doctor` | Generate fix tasks from a check FAIL |

## Workflows

### New feature

```
/agreement.create My new feature
/speckit.specify   My new feature
/speckit.plan      Tech stack details
/agreement.sync    001-my-feature
```

### Pre-merge check (pass)

```
/agreement.check diff    → PASS → merge
```

### Pre-merge check (fail → repair → pass)

```
/agreement.check diff                → FAIL + check-report.md
/agreement.doctor 001-my-feature     → corrective tasks in tasks.md
/speckit.implement                   → applies fixes
/agreement.check 001-my-feature      → PASS → merge
```

## Files installed

```
.agreements/                          # your agreements live here
├── agreement.md                      # documentation
├── index.yaml                        # global registry
├── config.yaml                       # project settings
├── _templates/
│   └── agreement.tpl.yaml            # agreement template
└── ###-feature-name/
    ├── agreement.yaml                # one agreement per feature
    └── check-report.md               # drift report (generated by /agreement.check)

.claude/commands/                     # Claude Code slash commands
├── agreement.create.md
├── agreement.sync.md
├── agreement.check.md
└── agreement.doctor.md
```

## Options

```
npx agreement-system init --skip-bmad    # skip BMAD integration
npx agreement-system init --force-bmad   # force BMAD integration even if not detected
npx agreement-system init --yes          # skip confirmation prompts
```

## Requirements

- Node.js 18+
- Claude Code (for slash commands)
- BMAD and/or Spec Kit (optional, enhances the experience)

## License

MIT
